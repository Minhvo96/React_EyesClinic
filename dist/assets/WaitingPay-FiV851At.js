import{c as m,d as A,r as o,j as e,Q as D,m as E}from"./index-QqQ6tGiF.js";import{m as p}from"./medicinePrescriptionService-f_e2kJtP.js";const g="https://14.225.205.182:8097/api/bill",F={getAllBills:async()=>m.get(g).then(r=>r.data).catch(r=>{console.log(r)}),createBill:async r=>m.post(g,r).then(c=>c.data).catch(c=>{console.log(c)}),editBill:async(r,c)=>m.put(g+"/"+c,r).then(j=>j.data).catch(j=>{console.log(j)}),deleteBill:async r=>m.delete(g+"/"+r).then(c=>c.data).catch(c=>{console.log(c)}),getBillById:async r=>m.get(g+"/"+r).then(c=>c.data).catch(c=>{console.log(c)})};function U(){const r=A(),[c,j]=o.useState([]),[u,T]=o.useState([]),[s,C]=o.useState(null),[I,B]=o.useState(!0),[t,L]=o.useState({id:"",fullName:"",eyeCategoryId:"",phoneNumber:"",dateBooking:"",timeBooking:"",idsMedicine:""}),[R,M]=o.useState({idPrescription:"",idReceptionist:"",idBooking:"",totalPrice:""}),y=async()=>{try{const a=(await p.getMdicinePrescription()).content;j(a),B(!1)}catch(n){console.log(n)}},z=async n=>{try{L(n);const a=await p.getPrescriptionByIdBooking(n.id),d=await p.getShowDetailPrescription(a);C(d)}catch(a){console.log(a)}};o.useEffect(()=>{console.log(s)},[s]);const V=async n=>{var d;const a={idPrescription:n.id,idReceptionist:(d=r==null?void 0:r.user)==null?void 0:d.id,idBooking:n.idBooking,totalPrice:n.totalAmount};try{const i=await F.createBill(a);console.log("Bill saved successfully:",i),D.success("Đã thanh toán hóa đơn!",{position:D.POSITION.TOP_RIGHT});const h=u.map(x=>x.id===n.idBooking?{...x,status:"UNPAID"}:x);M(a),await y(),$(`#modal-${n.idBooking}`).modal("hide"),$(".modal-backdrop").css("display","none")}catch(i){console.error("Error saving bill:",i)}};o.useEffect(()=>{y()},[]),o.useEffect(()=>{(async()=>{try{const d=(await Promise.all(c.map(async i=>{if(i.idBooking){const h=i.idBooking;return await E.getBookingById(h)}return null}))).filter(i=>i!==null&&i.status==="UNPAID");T(d)}catch(a){console.log(a)}})()},[c]);const k=n=>{const a=new Date(n),d=a.getDate(),i=a.getMonth()+1,h=a.getFullYear();return`${d} tháng ${String(i).padStart(2,"0")} năm ${h}`};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"container-fluid",children:[e.jsx("div",{children:e.jsx("div",{className:"d-flex align-items-center justify-content-between",children:e.jsx("h5",{className:"card-title fw-semibold mb-4",children:"Danh sách chờ thanh toán"})})}),I?e.jsx("span",{className:"loader"}):e.jsxs("div",{className:"card w-100",children:[e.jsxs("div",{className:"d-flex ps-4 pt-4",children:[e.jsx("span",{className:"h5 fw-semibold",children:c.length}),e.jsx("p",{className:"ms-1 fw-normal",children:"hóa đơn"})]}),e.jsxs("div",{className:"card-body p-4",children:[u.length?e.jsxs("table",{className:"table text-nowrap mb-0 align-middle",children:[e.jsx("thead",{className:"text-dark fs-3",children:e.jsxs("tr",{className:"text-center",children:[e.jsx("th",{children:"STT"}),e.jsx("th",{children:"Họ và tên"}),e.jsx("th",{children:"Số điện thoại"}),e.jsx("th",{children:"Ngày khám"}),e.jsx("th",{children:"Chi tiết hóa đơn"})]})}),e.jsx("tbody",{children:u.map((n,a)=>{const d=a+1;return e.jsxs("tr",{className:"text-center",children:[e.jsx("td",{children:d}),e.jsx("td",{children:n.customer.user.fullName}),e.jsx("td",{children:n.customer.user.phoneNumber}),e.jsx("td",{children:n.dateBooking}),e.jsx("td",{children:e.jsx("div",{className:"d-flex align-items-center justify-content-center",children:e.jsx("button",{className:"btn btn-outline-info d-flex align-items-center justify-content-center",style:{width:"36px",height:"36px"},type:"button","data-toggle":"modal","data-target":`#modal-${n.id}`,onClick:()=>z(n),children:e.jsx("i",{className:"ti ti-wallet",style:{fontSize:"18px"}})})})})]},n.id)})})]}):e.jsx("div",{className:"m-4",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center gap-4",style:{flexDirection:"column"},children:[e.jsx("div",{children:e.jsx("i",{class:"fa-regular fa-calendar-xmark text-danger",style:{fontSize:"124px"}})}),e.jsx("span",{className:"fw-semibold",style:{fontSize:"32px"},children:"Danh sách hôm nay đang trống!"})]})}),u.map((n,a)=>{var d,i,h,x,f,N,b,v,S;return e.jsx("div",{className:"modal-frame",children:e.jsx("div",{className:"modal fade",id:`modal-${n.id}`,tabIndex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:e.jsx("div",{class:"modal-content",children:e.jsxs("div",{className:"container-fluid",children:[e.jsxs("div",{class:"d-flex align-items-center row",children:[e.jsx("div",{class:"col-3 d-flex align-items-center justify-content-start",children:e.jsx("div",{class:"logo-container mt-4",style:{marginLeft:"20px",marginTop:"200px"},children:e.jsx("img",{src:"../../images/logo2.png",alt:"",class:"logo",style:{width:"240px"}})})}),e.jsx("div",{className:"col-6 flex justify-between",children:e.jsxs("div",{className:"flex flex-col justify-center items-center",style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",marginLeft:"20px",marginTop:"20px",marginRight:"20px"},children:[e.jsx("h1",{className:"",style:{fontSize:"36px"},children:"Phòng khám mắt Văn Minh"}),e.jsx("h1",{className:"",style:{fontSize:"20px"},children:"28 Lê Lợi - TP.Huế"}),e.jsx("h1",{className:"",style:{fontSize:"20px"},children:"ĐT: 0836.092.222"}),e.jsxs("h1",{className:"",style:{fontSize:"24px",fontWeight:"bolder"},children:["Mã BN: ",(i=(d=t==null?void 0:t.customer)==null?void 0:d.user)==null?void 0:i.phoneNumber]})]})}),e.jsx("div",{className:"col-3",style:{marginTop:"50px"},children:e.jsxs("div",{className:"d-flex align-items-center justify-content-around row mb-4",children:[e.jsx("div",{className:"col-5 d-flex align-items-center justify-content-center",children:e.jsx("h5",{children:"T2 - CN:"})}),e.jsxs("div",{className:"d-flex align-items-center justify-content-end col-7 gap-2",style:{flexDirection:"column"},children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center mb-0",children:e.jsx("p",{className:"mb-0",children:"08:00-12:00"})}),e.jsx("div",{className:"d-flex align-items-center justify-content-center",children:e.jsx("p",{className:"mb-0",children:"14:00-18:00"})})]})]})})]}),e.jsxs("div",{class:"modal-body",children:[e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx("h2",{className:"fw-bolder",style:{fontSize:"44px"},children:"ĐƠN THUỐC"})}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-9 mt-8 row",children:[e.jsx("strong",{className:"col-2",children:"Họ và tên: "}),e.jsx("span",{className:"col-10 d-flex justify-content-start",style:{paddingLeft:"4rem"},children:(x=(h=t==null?void 0:t.customer)==null?void 0:h.user)==null?void 0:x.fullName})]}),e.jsxs("div",{className:"col-3 mt-8 d-flex justify-content-end row",children:[e.jsx("strong",{className:"col-6",children:"Năm sinh:"}),e.jsx("span",{className:"d-flex justify-content-center col-6",children:(f=t==null?void 0:t.customer)==null?void 0:f.age})]})]}),e.jsxs("div",{class:"mt-8 d-flex align-items-center row",children:[e.jsx("strong",{className:"col-2",children:"Chẩn đoán:"}),e.jsx("span",{className:"d-flex justify-content-start col-10",children:s==null?void 0:s.diagnose})]}),e.jsxs("div",{class:"mt-8 row d-flex",children:[e.jsx("strong",{className:"col-2",children:"Bệnh phụ: "}),e.jsxs("span",{className:"d-flex justify-content-start align-items-center col-10",children:[s!=null&&s.note.split(",")[1]?s==null?void 0:s.note.split(",")[1]:"",s!=null&&s.note.split(",")[2]?", "+(s==null?void 0:s.note.split(",")[2])+", ":"",s!=null&&s.note.split(",")[3]?s==null?void 0:s.note.split(",")[3]:""]})]}),e.jsxs("div",{class:"mt-8 row d-flex",style:{marginBottom:"30px"},children:[e.jsx("strong",{className:"col-2",children:"Ghi chú: "}),e.jsx("span",{className:"d-flex justify-content-start align-items-center col-10",children:(s==null?void 0:s.note.split(",")[0])||""})]}),e.jsx("div",{class:"mt-8",style:{marginBottom:"30px"},children:e.jsxs("table",{class:"border-collapse",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{class:"border p-2 text-center"}),e.jsx("th",{class:"border p-2 text-center",children:"Thị lực"}),e.jsx("th",{class:"border p-2 text-center",children:"Mắt phải"}),e.jsx("th",{class:"border p-2 text-center",children:"Mắt trái"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{class:"border p-2 text-center",children:"MP"}),e.jsx("td",{class:"border p-2 text-center",children:s!=null&&s.eyeSight?s.eyeSight[0]+"/10":null}),e.jsx("td",{rowSpan:3,className:"border p-2 text-center",children:e.jsx("i",{class:"fa-solid fa-eye",style:{fontSize:"60px"}})}),e.jsx("td",{rowSpan:3,className:"border p-2 text-center",children:e.jsx("i",{class:"fa-solid fa-eye",style:{fontSize:"60px"}})})]}),e.jsxs("tr",{children:[e.jsx("td",{class:"border p-2 text-center",children:"MT"}),e.jsx("td",{class:"border p-2 text-center",children:s!=null&&s.eyeSight?s.eyeSight[3]+"/10":null})]}),e.jsxs("tr",{children:[e.jsx("td",{class:"border p-2 text-center",children:"Khác"}),e.jsx("td",{class:"border p-2 text-center"})]})]})]})}),e.jsx("div",{class:"mt-8",children:e.jsxs("table",{class:" mt-8 border-collapse",style:{width:"100%"},children:[e.jsxs("thead",{children:[e.jsxs("tr",{children:[e.jsx("th",{class:"border p-2 text-center"}),e.jsx("th",{colSpan:4,class:"border p-2 text-center",children:"Dịch vụ"}),e.jsx("th",{class:"border p-2 text-center",children:"Giá dịch vụ"})]}),e.jsxs("tr",{children:[e.jsx("th",{class:"border p-2 text-center"}),t!=null&&t.eyeCategory?e.jsxs(e.Fragment,{children:[e.jsx("td",{colSpan:4,className:"border p-2 text-center",children:(N=t==null?void 0:t.eyeCategory)==null?void 0:N.nameCategory}),e.jsx("td",{className:"border p-2 text-center",children:(b=t==null?void 0:t.eyeCategory)==null?void 0:b.price.toLocaleString("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0})})]}):null]}),e.jsxs("tr",{children:[e.jsx("th",{class:"border p-2 text-center",children:"STT"}),e.jsx("th",{class:"border p-2 text-center",children:"Tên thuốc"}),e.jsx("th",{class:"border p-2 text-center",children:"Đơn vị"}),e.jsx("th",{class:"border p-2 text-center",children:"Số lượng"}),e.jsx("th",{class:"border p-2 text-center",children:"Đơn giá"}),e.jsx("th",{class:"border p-2 text-center",children:"Thành tiền"})]})]}),e.jsxs("tbody",{children:[s!=null&&s.medicines&&s.medicines.length>0?s.medicines.map((l,w)=>e.jsx(e.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{class:"border p-2 text-center",children:w+(t!=null&&t.eyeCategories?t.eyeCategories.length:0)+(t!=null&&t.eyeCategory?1:0)}),e.jsx("td",{class:"border p-2 text-center",children:e.jsxs("div",{className:"d-flex justify-content-center align-items-center",children:[e.jsx("div",{children:l==null?void 0:l.nameMedicine}),e.jsx("div",{style:{fontSize:"13px"},children:e.jsxs("em",{children:[" ( ",l==null?void 0:l.useMedicine," - ",l==null?void 0:l.noteMedicine," )"]})})]})}),e.jsx("td",{class:"border p-2 text-center",children:(l==null?void 0:l.type)==="PELLET"?"Viên":"Chai"}),e.jsx("td",{class:"border p-2 text-center",children:l==null?void 0:l.quantity}),e.jsx("td",{class:"border p-2 text-center",children:l==null?void 0:l.priceMedicine.toLocaleString("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0})}),e.jsx("td",{class:"border p-2 text-center",children:((l==null?void 0:l.priceMedicine)*(l==null?void 0:l.quantity)).toLocaleString("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0})})]},w+(t!=null&&t.eyeCategories?t.eyeCategories.length:0)+(t!=null&&t.eyeCategory?2:1))})):null,e.jsxs("tr",{children:[e.jsx("td",{class:"border p-2 text-center"}),e.jsx("th",{colSpan:4,class:"border p-2 text-center",children:"Tổng tiền:"}),e.jsx("td",{class:"border p-2 text-danger text-center fw-bolder",children:s==null?void 0:s.totalAmount.toLocaleString("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0})})]})]})]})}),e.jsx("div",{class:"mt-4",children:e.jsxs("strong",{children:["Ngày khám: ",e.jsxs("span",{className:"fw-normal",children:[" ",k(t==null?void 0:t.dateBooking)]})]})}),e.jsxs("div",{className:"row mt-2 d-flex align-items-center",children:[e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-end",style:{flexDirection:"column"},children:[e.jsx("strong",{children:"Người thu tiền"}),e.jsx("p",{className:"mt-5",children:(v=r==null?void 0:r.user)==null?void 0:v.fullName})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-end",style:{flexDirection:"column"},children:[e.jsx("strong",{children:"Bác sĩ khám bệnh"}),e.jsxs("p",{className:"mt-5",children:["ThS BS ",(S=s==null?void 0:s.doctor)==null?void 0:S.name]})]})})]})]}),e.jsxs("div",{class:"modal-footer",children:[e.jsx("button",{id:"close-save",class:"btn btn-primary mr-2",type:"button",onClick:()=>V(s),children:"Xác nhận"}),e.jsx("button",{id:"close-button",type:"button",class:"btn btn-danger mr-2","data-dismiss":"modal",children:"Đóng"})]})]})})})})},n.id)})]})]})]})})}export{U as default};
