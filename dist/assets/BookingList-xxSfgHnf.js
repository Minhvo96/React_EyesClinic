import{r as a,q as I,s as A,j as e,m,t as M,S as f,Q as p}from"./index-QqQ6tGiF.js";import{R as re}from"./react-paginate-czkzMCCC.js";function ye(){const[h,R]=a.useState(""),[c,C]=a.useState({}),[r,d]=a.useState({}),[l,y]=a.useState([]),[T,k]=a.useState([]),[F,H]=a.useState([]),[b,$]=a.useState({}),[D,de]=a.useState(["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30"]),[W,ge]=a.useState(["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30"]),[G,me]=a.useState(["14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30"]),[U,E]=a.useState([]);a.useState();const[K,J]=a.useState(!0);a.useState(!1);const[u,X]=a.useState("all"),z=()=>{const t=new Date,n=t.getFullYear(),s=t.getMonth()+1,i=t.getDate();R(`${n}-${s.toString().padStart(2,"0")}-${i.toString().padStart(2,"0")}`)},V=async()=>{const t={idEyeCategory:"",idCustomer:"",timeBooking:"",dateBooking:String(h),status:""},n=await m.getBookingByStatusPendingAndDate(t);y(n),J(!1)},_=async t=>{const n={idEyeCategory:"",idCustomer:"",timeBooking:"",dateBooking:String(t.target.value),status:""},s=await m.getBookingByStatusPendingAndDate(n);y(s)},q=async t=>{const n=await m.getBookingById(t);C(n),B(n.dateBooking)},B=async t=>{const n={idEyeCategory:"",idCustomer:"",timeBooking:"",dateBooking:String(t),status:""},i=(await m.getBookingByStatusWaitingAndDate(n)).map(x=>x.timeBooking),o=new Date,g=o.getHours(),ce=o.getMinutes(),le=`${g.toString().padStart(2,"0")}:${ce.toString().padStart(2,"0")}`;if(new Date(t)>o){const x=D.filter(j=>!i.includes(j));E(x)}else{const x=D.filter(j=>!i.includes(j)&&j.localeCompare(le)>0);E(x)}},Q=async()=>{const t=await M.getAllEyeCategories();H(t)},Y=async t=>{const n=await M.getEyeCategoryById(t.target.value);$(n)},Z=()=>{if(Object.keys(b).length)if(Object.keys(r).length){const t={...r,eyeCategory:{id:b.id}};d(t)}else{const t={...c,eyeCategory:{id:b.id}};d(t)}},N=async t=>{if(Object.keys(r).length)if(t.target.name=="dateBooking"){const n=t.target.value;B(n);const s={...r,[t.target.name]:t.target.value};d(s)}else{const n={...r,[t.target.name]:t.target.value};d(n)}else if(t.target.name=="dateBooking"){const n=t.target.value;B(n);const s={...c,[t.target.name]:t.target.value};d(s)}else{const n={...c,[t.target.name]:t.target.value};d(n)}},ee=async()=>{console.log(r),await v(r),f.fire({position:"center",icon:"success",title:"Cập Nhật Thành Công !",showConfirmButton:!1,timer:1500})},v=async t=>{const n={idEyeCategory:String(t.eyeCategory.id),idCustomer:String(t.customer.id),timeBooking:t.timeBooking,dateBooking:t.dateBooking,status:t.status,message:t.message},s=await m.editBooking(n,t.id),i=l.findIndex(g=>g.id===t.id),o=[...l];o[i]=s,y(o),C({}),d({})},te=t=>{f.fire({title:"Bạn chắc chắn muốn hủy lịch hẹn khám này chứ?",showCancelButton:!0,confirmButtonText:"Hủy",cancelButtonText:"Không"}).then(async n=>{if(n.isConfirmed){const i={...await m.getBookingById(t),status:"CANCELLED"};await v(i),f.fire("Hủy thành công!","","success"),y(o=>o.filter(g=>g.id!==t))}})},ne=async t=>{f.fire({title:"Xác nhận khám lịch hẹn này?",showCancelButton:!0,confirmButtonText:"Có",cancelButtonText:"Không"}).then(async n=>{if(n.isConfirmed){const i={...await m.getBookingById(t),status:"WAITING"};await v(i),f.fire({position:"center",icon:"success",title:"Xác Nhận Thành Công !",showConfirmButton:!1,timer:1500}),y(o=>o.filter(g=>g.id!==t))}})},L=()=>{C({})},S=t=>{X(t),t==="all"?k(l):t==="morning"?k(l.filter(n=>W.includes(n.timeBooking))):t==="afternoon"&&k(l.filter(n=>G.includes(n.timeBooking)))};a.useEffect(()=>{const t="https://14.225.205.182:8097/ws",n=new I(t),s=A.over(n),i=o=>{console.log("Received message:",o.body),p.success(JSON.parse(o.body).content,{position:p.POSITION.TOP_RIGHT})};return s.connect({},()=>{console.log("SOCKET Connected"),s.subscribe("/topic/publicChatRoom",i)},o=>{console.error("WebSocket error:",o)}),()=>{s.disconnect()}},[]),a.useEffect(()=>{k(l)},[l]),a.useEffect(()=>{Z()},[b]),a.useEffect(()=>{Q(),z()},[]),a.useEffect(()=>{const t="https://14.225.205.182:8097/ws",n=new I(t),s=A.over(n),i=o=>{console.log("Received message:",o.body),p.success(JSON.parse(o.body).content,{position:p.POSITION.TOP_RIGHT})};return s.connect({},()=>{console.log("SOCKET Connected"),s.subscribe("/topic/publicChatRoom",i)},o=>{console.error("WebSocket error:",o)}),()=>{s.disconnect()}},[]),a.useEffect(()=>{h&&V()},[h]);const[se,ae]=a.useState(0),w=5,oe=t=>{ae(t.selected)},O=(se+1)*w,P=O-w,ie=T.sort((t,n)=>t.timeBooking.localeCompare(n.timeBooking)).slice(P,O);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"container-fluid",children:[e.jsx("div",{className:"d-flex align-items-center justify-content-between",children:e.jsx("h5",{className:"card-title fw-semibold mb-4",children:"Danh sách hẹn khám"})}),e.jsx("div",{className:"col-lg-12 d-flex align-items-around",style:{padding:0},children:e.jsxs("div",{className:"card w-100",children:[e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("h6",{className:"mr-3",children:"Chọn ngày: "}),e.jsx("div",{className:"col-7 ",children:e.jsx("input",{type:"date",className:"form-control",defaultValue:h,onChange:_,min:h})})]}),e.jsxs("div",{className:"d-flex align-items-center gap-4",children:[e.jsx("div",{children:e.jsx("button",{className:"btn btn-outline-primary",onClick:()=>S("all"),style:{backgroundColor:u==="all"?"#007bff":"initial",color:u==="all"?"#fff":"initial"},children:"Tất cả"})}),e.jsx("div",{children:e.jsx("button",{className:"btn btn-outline-primary",onClick:()=>S("morning"),style:{backgroundColor:u==="morning"?"#007bff":"initial",color:u==="morning"?"#fff":"initial"},children:"Sáng"})}),e.jsx("div",{children:e.jsx("button",{className:"btn btn-outline-primary",onClick:()=>S("afternoon"),style:{backgroundColor:u==="afternoon"?"#007bff":"initial",color:u==="afternoon"?"#fff":"initial"},children:"Chiều"})})]})]})}),e.jsx("div",{className:"card-body p-2",children:K?e.jsx("span",{className:"loader"}):T.length?e.jsx(e.Fragment,{children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"thead-primary",children:e.jsxs("tr",{children:[e.jsx("th",{children:"STT"}),e.jsx("th",{children:"Họ và tên"}),e.jsx("th",{children:"Số điện thoại"}),e.jsx("th",{children:"Ngày khám"}),e.jsx("th",{children:"Giờ khám"}),e.jsx("th",{className:"text-center",children:"Dịch vụ"}),e.jsx("th",{className:"col-4 text-center",children:"Hành động"})]})}),e.jsx("tbody",{children:ie.map((t,n)=>{const s=n+1+P;return e.jsxs("tr",{children:[e.jsx("td",{className:"text-center",children:s}),e.jsx("td",{children:t.customer.user.fullName}),e.jsx("td",{children:t.customer.user.phoneNumber}),e.jsx("td",{children:t.dateBooking}),e.jsx("td",{className:"text-center",children:t.timeBooking}),e.jsx("td",{className:"text-center",children:t.eyeCategory.nameCategory}),e.jsxs("td",{className:"text-center",children:[e.jsx("button",{className:"btn btn-warning mr-2",type:"button","data-toggle":"modal","data-target":"#exampleModal",onClick:()=>q(t.id),children:"Sửa"}),e.jsx("button",{className:"btn btn-danger mr-2",onClick:()=>te(t.id),children:"Hủy"}),e.jsx("button",{className:"btn btn-success",onClick:()=>ne(t.id),children:"Xác nhận khám"})]})]},t.id)})})]})}):e.jsx("div",{className:"m-4",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center gap-4",style:{flexDirection:"column"},children:[e.jsx("div",{children:e.jsx("i",{className:"fa-regular fa-calendar-xmark text-danger",style:{fontSize:"124px"}})}),e.jsx("span",{className:"fw-semibold",style:{fontSize:"32px"},children:"Danh sách hôm nay đang trống!"})]})})})]})}),e.jsx("div",{className:"pagination-container",style:{margin:0,display:"flex",justifyContent:"flex-end"},children:e.jsx(re,{pageCount:Math.ceil(l.length/w),pageRangeDisplayed:5,marginPagesDisplayed:2,onPageChange:oe,containerClassName:"pagination",activeClassName:"active",previousLabel:"Previous",nextLabel:"Next",breakLabel:"..."})})]}),e.jsx("div",{className:"modal fade",id:"exampleModal",tabIndex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title font-weight-bold",id:"exampleModalLabel",children:"Thay đổi thông tin lịch hẹn"}),e.jsx("button",{type:"button",className:"btn-close","data-dismiss":"modal","aria-label":"Close",onClick:L})]}),e.jsx("div",{className:"modal-body",children:Object.keys(c).length&&e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{children:"Họ và tên"}),e.jsx("input",{type:"text",className:"form-control",value:c.customer.user.fullName,readOnly:!0})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{children:"Số điện thoại"}),e.jsx("input",{type:"text",className:"form-control",value:c.customer.user.phoneNumber,readOnly:!0})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{children:"Ngày khám"}),e.jsx("input",{type:"date",className:"form-control",name:"dateBooking",defaultValue:c.dateBooking,min:h,onChange:N})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{children:"Dịch vụ"}),e.jsxs("select",{name:"eyeCategory",id:"categorySelect",className:"form-control",onChange:Y,children:[e.jsx("option",{value:c.eyeCategory.id,children:c.eyeCategory.nameCategory}),F.map(t=>{if(t.nameCategory!=c.eyeCategory.nameCategory)return e.jsx("option",{value:t.id,children:t.nameCategory},t.id)})]})]})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{children:"Giờ khám"}),e.jsx("select",{className:"form-control",name:"timeBooking",id:"",onChange:N,children:U.map((t,n)=>e.jsx("option",{value:t,selected:t==c.timeBooking,children:t},n))})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{children:"Lý do thay đổi"}),e.jsx("input",{type:"text",className:"form-control",name:"message",onChange:N})]})]})]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary","data-dismiss":"modal",onClick:L,children:"Close"}),e.jsx("button",{type:"button",className:"btn btn-primary","data-dismiss":"modal",onClick:ee,children:"Save changes"})]})]})})})]})}export{ye as default};
